from sympy import symbols
from sympy.matrices import Matrix




phi_L, phi_R, phi_halfNext_L, phi_halfNext_R = symbols("phi_L, phi_R, phi_halfNext_L, phi_halfNext_R")
Ql, Qr, Q_halfNext_L, Q_halfNext_R = symbols("Ql, Qr, Q_halfNext_L, Q_halfNext_R")
psi_halfLast_L, psi_halfLast_R = symbols("psi_halfLast_L, psi_halfLast_R")
psi_leftBound,psi_rightBound, psi_halfNext_leftBound, psi_halfNext_rightBound = symbols("psi_leftBound,psi_rightBound, psi_halfNext_leftBound, psi_halfNext_rightBound")


#dx, dt, v, mu, xsec_total, xsec_scatter  = symbols("dx, dt, v, mu, xsec_total, xsec_scatter")
#gamma = (dx*xsec_total)/2
#timer = dx/(v*dt)
#timer2 = dx/(2*v*dt)
#a = mu/2

gamma, timer, timer2, a  = symbols("gamma, timer, timer2, a")
xsec_scatter, mu, dx = symbols("xsec_scatter, mu, dx")


A_n = Matrix([[-a + gamma, a,          timer2,            0],
                [-a,         -a + gamma, 0,                 timer2],
                [-timer,     0,          timer - a + gamma, a],
                [0,          -timer,     -a,                timer -a + gamma]])


A_p = Matrix([[a + gamma, a,         timer2,            0],
                [-a,        a + gamma, 0,                 timer2],
                [-timer,    0,         timer + a + gamma, a],
                [0,         -timer,    -a,                timer +a + gamma]])



b_p = Matrix([[dx/4*(xsec_scatter*phi_L + Ql) + timer2*psi_halfLast_L + mu*psi_leftBound],
                [dx/4*(xsec_scatter*phi_R + Qr) + timer2*psi_halfLast_R],
                [dx/4*(xsec_scatter*phi_halfNext_L + Q_halfNext_L) + mu*psi_halfNext_leftBound],
                [dx/4*(xsec_scatter*phi_halfNext_R + Q_halfNext_R)]])




b_n = Matrix([[dx/4*(xsec_scatter*phi_L + Ql) + timer2*psi_halfLast_L],
                [dx/4*(xsec_scatter*phi_R + Qr) + timer2*psi_halfLast_R - mu*psi_rightBound],
                [dx/4*(xsec_scatter*phi_halfNext_L + Q_halfNext_L) ],
                [dx/4*(xsec_scatter*phi_halfNext_R + Q_halfNext_R) - mu*psi_halfNext_rightBound]])

print(A_p.solve(b_p))

import numpy as np

def neg_sweep(dx, v, dt, mu, xsec_total, Ql, Qr, Q_halfNext_L, Q_halfNext_R, psi_halfLast_L, psi_halfLast_R, psi_rightBound, psi_halfNext_rightBound, xsec_scatter, phi_L, phi_R, phi_halfNext_L, phi_halfNext_R):


    gamma = (dx*xsec_total)/2
    timer = dx/(v*dt)
    timer2 = dx/(2*v*dt)
    a = mu/2

    psi_n = np.zeros(4)

    psi_n[0] = (2*Q_halfNext_L*a*dx*gamma*timer2 + Q_halfNext_L*a*dx*timer*timer2 - Q_halfNext_L*dx*gamma**2*timer2 - Q_halfNext_L*dx*gamma*timer*timer2 - Q_halfNext_L*dx*timer*timer2**2 - 2*Q_halfNext_R*a**2*dx*timer2 + 2*Q_halfNext_R*a*dx*gamma*timer2 + Q_halfNext_R*a*dx*timer*timer2 - 2*Ql*a**3*dx + 4*Ql*a**2*dx*gamma + 2*Ql*a**2*dx*timer - 3*Ql*a*dx*gamma**2 - 4*Ql*a*dx*gamma*timer - Ql*a*dx*timer**2 - Ql*a*dx*timer*timer2 + Ql*dx*gamma**3 + 2*Ql*dx*gamma**2*timer + Ql*dx*gamma*timer**2 + Ql*dx*gamma*timer*timer2 + Ql*dx*timer**2*timer2 - 2*Qr*a**3*dx + 2*Qr*a**2*dx*gamma + 2*Qr*a**2*dx*timer - Qr*a*dx*gamma**2 - 2*Qr*a*dx*gamma*timer - Qr*a*dx*timer**2 + Qr*a*dx*timer*timer2 - 2*a**3*dx*phi_L*xsec_scatter - 2*a**3*dx*phi_R*xsec_scatter + 8*a**3*mu*psi_rightBound - 8*a**3*psi_halfLast_L*timer2 - 8*a**3*psi_halfLast_R*timer2 + 4*a**2*dx*gamma*phi_L*xsec_scatter + 2*a**2*dx*gamma*phi_R*xsec_scatter + 2*a**2*dx*phi_L*timer*xsec_scatter + 2*a**2*dx*phi_R*timer*xsec_scatter - 2*a**2*dx*phi_halfNext_R*timer2*xsec_scatter - 8*a**2*gamma*mu*psi_rightBound + 16*a**2*gamma*psi_halfLast_L*timer2 + 8*a**2*gamma*psi_halfLast_R*timer2 + 8*a**2*mu*psi_halfNext_rightBound*timer2 - 8*a**2*mu*psi_rightBound*timer + 8*a**2*psi_halfLast_L*timer*timer2 + 8*a**2*psi_halfLast_R*timer*timer2 - 3*a*dx*gamma**2*phi_L*xsec_scatter - a*dx*gamma**2*phi_R*xsec_scatter - 4*a*dx*gamma*phi_L*timer*xsec_scatter - 2*a*dx*gamma*phi_R*timer*xsec_scatter + 2*a*dx*gamma*phi_halfNext_L*timer2*xsec_scatter + 2*a*dx*gamma*phi_halfNext_R*timer2*xsec_scatter - a*dx*phi_L*timer**2*xsec_scatter - a*dx*phi_L*timer*timer2*xsec_scatter - a*dx*phi_R*timer**2*xsec_scatter + a*dx*phi_R*timer*timer2*xsec_scatter + a*dx*phi_halfNext_L*timer*timer2*xsec_scatter + a*dx*phi_halfNext_R*timer*timer2*xsec_scatter + 4*a*gamma**2*mu*psi_rightBound - 12*a*gamma**2*psi_halfLast_L*timer2 - 4*a*gamma**2*psi_halfLast_R*timer2 - 8*a*gamma*mu*psi_halfNext_rightBound*timer2 + 8*a*gamma*mu*psi_rightBound*timer - 16*a*gamma*psi_halfLast_L*timer*timer2 - 8*a*gamma*psi_halfLast_R*timer*timer2 - 4*a*mu*psi_halfNext_rightBound*timer*timer2 + 4*a*mu*psi_rightBound*timer**2 - 4*a*mu*psi_rightBound*timer*timer2 - 4*a*psi_halfLast_L*timer**2*timer2 - 4*a*psi_halfLast_L*timer*timer2**2 - 4*a*psi_halfLast_R*timer**2*timer2 + 4*a*psi_halfLast_R*timer*timer2**2 + dx*gamma**3*phi_L*xsec_scatter + 2*dx*gamma**2*phi_L*timer*xsec_scatter - dx*gamma**2*phi_halfNext_L*timer2*xsec_scatter + dx*gamma*phi_L*timer**2*xsec_scatter + dx*gamma*phi_L*timer*timer2*xsec_scatter - dx*gamma*phi_halfNext_L*timer*timer2*xsec_scatter + dx*phi_L*timer**2*timer2*xsec_scatter - dx*phi_halfNext_L*timer*timer2**2*xsec_scatter + 4*gamma**3*psi_halfLast_L*timer2 + 8*gamma**2*psi_halfLast_L*timer*timer2 + 4*gamma*psi_halfLast_L*timer**2*timer2 + 4*gamma*psi_halfLast_L*timer*timer2**2 + 4*psi_halfLast_L*timer**2*timer2**2)/(16*a**4 - 32*a**3*gamma - 16*a**3*timer + 32*a**2*gamma**2 + 32*a**2*gamma*timer + 8*a**2*timer**2 - 16*a*gamma**3 - 24*a*gamma**2*timer - 8*a*gamma*timer**2 - 16*a*gamma*timer*timer2 - 8*a*timer**2*timer2 + 4*gamma**4 + 8*gamma**3*timer + 4*gamma**2*timer**2 + 8*gamma**2*timer*timer2 + 8*gamma*timer**2*timer2 + 4*timer**2*timer2**2)
    psi_n[1] = (2*Q_halfNext_L*a**2*dx*timer2 - 2*Q_halfNext_L*a*dx*gamma*timer2 - Q_halfNext_L*a*dx*timer*timer2 + 2*Q_halfNext_R*a*dx*gamma*timer2 + Q_halfNext_R*a*dx*timer*timer2 - Q_halfNext_R*dx*gamma**2*timer2 - Q_halfNext_R*dx*gamma*timer*timer2 - Q_halfNext_R*dx*timer*timer2**2 + 2*Ql*a**3*dx - 2*Ql*a**2*dx*gamma - 2*Ql*a**2*dx*timer + Ql*a*dx*gamma**2 + 2*Ql*a*dx*gamma*timer + Ql*a*dx*timer**2 - Ql*a*dx*timer*timer2 - 2*Qr*a**3*dx + 4*Qr*a**2*dx*gamma + 2*Qr*a**2*dx*timer - 3*Qr*a*dx*gamma**2 - 4*Qr*a*dx*gamma*timer - Qr*a*dx*timer**2 - Qr*a*dx*timer*timer2 + Qr*dx*gamma**3 + 2*Qr*dx*gamma**2*timer + Qr*dx*gamma*timer**2 + Qr*dx*gamma*timer*timer2 + Qr*dx*timer**2*timer2 + 2*a**3*dx*phi_L*xsec_scatter - 2*a**3*dx*phi_R*xsec_scatter + 8*a**3*mu*psi_rightBound + 8*a**3*psi_halfLast_L*timer2 - 8*a**3*psi_halfLast_R*timer2 - 2*a**2*dx*gamma*phi_L*xsec_scatter + 4*a**2*dx*gamma*phi_R*xsec_scatter - 2*a**2*dx*phi_L*timer*xsec_scatter + 2*a**2*dx*phi_R*timer*xsec_scatter + 2*a**2*dx*phi_halfNext_L*timer2*xsec_scatter - 16*a**2*gamma*mu*psi_rightBound - 8*a**2*gamma*psi_halfLast_L*timer2 + 16*a**2*gamma*psi_halfLast_R*timer2 - 8*a**2*mu*psi_rightBound*timer - 8*a**2*psi_halfLast_L*timer*timer2 + 8*a**2*psi_halfLast_R*timer*timer2 + a*dx*gamma**2*phi_L*xsec_scatter - 3*a*dx*gamma**2*phi_R*xsec_scatter + 2*a*dx*gamma*phi_L*timer*xsec_scatter - 4*a*dx*gamma*phi_R*timer*xsec_scatter - 2*a*dx*gamma*phi_halfNext_L*timer2*xsec_scatter + 2*a*dx*gamma*phi_halfNext_R*timer2*xsec_scatter + a*dx*phi_L*timer**2*xsec_scatter - a*dx*phi_L*timer*timer2*xsec_scatter - a*dx*phi_R*timer**2*xsec_scatter - a*dx*phi_R*timer*timer2*xsec_scatter - a*dx*phi_halfNext_L*timer*timer2*xsec_scatter + a*dx*phi_halfNext_R*timer*timer2*xsec_scatter + 12*a*gamma**2*mu*psi_rightBound + 4*a*gamma**2*psi_halfLast_L*timer2 - 12*a*gamma**2*psi_halfLast_R*timer2 - 8*a*gamma*mu*psi_halfNext_rightBound*timer2 + 16*a*gamma*mu*psi_rightBound*timer + 8*a*gamma*psi_halfLast_L*timer*timer2 - 16*a*gamma*psi_halfLast_R*timer*timer2 - 4*a*mu*psi_halfNext_rightBound*timer*timer2 + 4*a*mu*psi_rightBound*timer**2 + 4*a*mu*psi_rightBound*timer*timer2 + 4*a*psi_halfLast_L*timer**2*timer2 - 4*a*psi_halfLast_L*timer*timer2**2 - 4*a*psi_halfLast_R*timer**2*timer2 - 4*a*psi_halfLast_R*timer*timer2**2 + dx*gamma**3*phi_R*xsec_scatter + 2*dx*gamma**2*phi_R*timer*xsec_scatter - dx*gamma**2*phi_halfNext_R*timer2*xsec_scatter + dx*gamma*phi_R*timer**2*xsec_scatter + dx*gamma*phi_R*timer*timer2*xsec_scatter - dx*gamma*phi_halfNext_R*timer*timer2*xsec_scatter + dx*phi_R*timer**2*timer2*xsec_scatter - dx*phi_halfNext_R*timer*timer2**2*xsec_scatter - 4*gamma**3*mu*psi_rightBound + 4*gamma**3*psi_halfLast_R*timer2 + 4*gamma**2*mu*psi_halfNext_rightBound*timer2 - 8*gamma**2*mu*psi_rightBound*timer + 8*gamma**2*psi_halfLast_R*timer*timer2 + 4*gamma*mu*psi_halfNext_rightBound*timer*timer2 - 4*gamma*mu*psi_rightBound*timer**2 - 4*gamma*mu*psi_rightBound*timer*timer2 + 4*gamma*psi_halfLast_R*timer**2*timer2 + 4*gamma*psi_halfLast_R*timer*timer2**2 + 4*mu*psi_halfNext_rightBound*timer*timer2**2 - 4*mu*psi_rightBound*timer**2*timer2 + 4*psi_halfLast_R*timer**2*timer2**2)/(16*a**4 - 32*a**3*gamma - 16*a**3*timer + 32*a**2*gamma**2 + 32*a**2*gamma*timer + 8*a**2*timer**2 - 16*a*gamma**3 - 24*a*gamma**2*timer - 8*a*gamma*timer**2 - 16*a*gamma*timer*timer2 - 8*a*timer**2*timer2 + 4*gamma**4 + 8*gamma**3*timer + 4*gamma**2*timer**2 + 8*gamma**2*timer*timer2 + 8*gamma*timer**2*timer2 + 4*timer**2*timer2**2)
    psi_n[2] = (-2*Q_halfNext_L*a**3*dx + 4*Q_halfNext_L*a**2*dx*gamma + 2*Q_halfNext_L*a**2*dx*timer - 3*Q_halfNext_L*a*dx*gamma**2 - 2*Q_halfNext_L*a*dx*gamma*timer - Q_halfNext_L*a*dx*timer*timer2 + Q_halfNext_L*dx*gamma**3 + Q_halfNext_L*dx*gamma**2*timer + Q_halfNext_L*dx*gamma*timer*timer2 - 2*Q_halfNext_R*a**3*dx + 2*Q_halfNext_R*a**2*dx*gamma - Q_halfNext_R*a*dx*gamma**2 + Q_halfNext_R*a*dx*timer*timer2 - 2*Ql*a*dx*gamma*timer - Ql*a*dx*timer**2 + Ql*dx*gamma**2*timer + Ql*dx*gamma*timer**2 + Ql*dx*timer**2*timer2 + 2*Qr*a**2*dx*timer - 2*Qr*a*dx*gamma*timer - Qr*a*dx*timer**2 - 2*a**3*dx*phi_halfNext_L*xsec_scatter - 2*a**3*dx*phi_halfNext_R*xsec_scatter + 8*a**3*mu*psi_halfNext_rightBound + 4*a**2*dx*gamma*phi_halfNext_L*xsec_scatter + 2*a**2*dx*gamma*phi_halfNext_R*xsec_scatter + 2*a**2*dx*phi_R*timer*xsec_scatter + 2*a**2*dx*phi_halfNext_L*timer*xsec_scatter - 8*a**2*gamma*mu*psi_halfNext_rightBound - 8*a**2*mu*psi_rightBound*timer + 8*a**2*psi_halfLast_R*timer*timer2 - 3*a*dx*gamma**2*phi_halfNext_L*xsec_scatter - a*dx*gamma**2*phi_halfNext_R*xsec_scatter - 2*a*dx*gamma*phi_L*timer*xsec_scatter - 2*a*dx*gamma*phi_R*timer*xsec_scatter - 2*a*dx*gamma*phi_halfNext_L*timer*xsec_scatter - a*dx*phi_L*timer**2*xsec_scatter - a*dx*phi_R*timer**2*xsec_scatter - a*dx*phi_halfNext_L*timer*timer2*xsec_scatter + a*dx*phi_halfNext_R*timer*timer2*xsec_scatter + 4*a*gamma**2*mu*psi_halfNext_rightBound + 8*a*gamma*mu*psi_rightBound*timer - 8*a*gamma*psi_halfLast_L*timer*timer2 - 8*a*gamma*psi_halfLast_R*timer*timer2 - 4*a*mu*psi_halfNext_rightBound*timer*timer2 + 4*a*mu*psi_rightBound*timer**2 - 4*a*psi_halfLast_L*timer**2*timer2 - 4*a*psi_halfLast_R*timer**2*timer2 + dx*gamma**3*phi_halfNext_L*xsec_scatter + dx*gamma**2*phi_L*timer*xsec_scatter + dx*gamma**2*phi_halfNext_L*timer*xsec_scatter + dx*gamma*phi_L*timer**2*xsec_scatter + dx*gamma*phi_halfNext_L*timer*timer2*xsec_scatter + dx*phi_L*timer**2*timer2*xsec_scatter + 4*gamma**2*psi_halfLast_L*timer*timer2 + 4*gamma*psi_halfLast_L*timer**2*timer2 + 4*psi_halfLast_L*timer**2*timer2**2)/(16*a**4 - 32*a**3*gamma - 16*a**3*timer + 32*a**2*gamma**2 + 32*a**2*gamma*timer + 8*a**2*timer**2 - 16*a*gamma**3 - 24*a*gamma**2*timer - 8*a*gamma*timer**2 - 16*a*gamma*timer*timer2 - 8*a*timer**2*timer2 + 4*gamma**4 + 8*gamma**3*timer + 4*gamma**2*timer**2 + 8*gamma**2*timer*timer2 + 8*gamma*timer**2*timer2 + 4*timer**2*timer2**2) 
    psi_n[3] = (2*Q_halfNext_L*a**3*dx - 2*Q_halfNext_L*a**2*dx*gamma + Q_halfNext_L*a*dx*gamma**2 - Q_halfNext_L*a*dx*timer*timer2 - 2*Q_halfNext_R*a**3*dx + 4*Q_halfNext_R*a**2*dx*gamma + 2*Q_halfNext_R*a**2*dx*timer - 3*Q_halfNext_R*a*dx*gamma**2 - 2*Q_halfNext_R*a*dx*gamma*timer - Q_halfNext_R*a*dx*timer*timer2 + Q_halfNext_R*dx*gamma**3 + Q_halfNext_R*dx*gamma**2*timer + Q_halfNext_R*dx*gamma*timer*timer2 - 2*Ql*a**2*dx*timer + 2*Ql*a*dx*gamma*timer + Ql*a*dx*timer**2 - 2*Qr*a*dx*gamma*timer - Qr*a*dx*timer**2 + Qr*dx*gamma**2*timer + Qr*dx*gamma*timer**2 + Qr*dx*timer**2*timer2 + 2*a**3*dx*phi_halfNext_L*xsec_scatter - 2*a**3*dx*phi_halfNext_R*xsec_scatter + 8*a**3*mu*psi_halfNext_rightBound - 2*a**2*dx*gamma*phi_halfNext_L*xsec_scatter + 4*a**2*dx*gamma*phi_halfNext_R*xsec_scatter - 2*a**2*dx*phi_L*timer*xsec_scatter + 2*a**2*dx*phi_halfNext_R*timer*xsec_scatter - 16*a**2*gamma*mu*psi_halfNext_rightBound - 8*a**2*mu*psi_halfNext_rightBound*timer - 8*a**2*psi_halfLast_L*timer*timer2 + a*dx*gamma**2*phi_halfNext_L*xsec_scatter - 3*a*dx*gamma**2*phi_halfNext_R*xsec_scatter + 2*a*dx*gamma*phi_L*timer*xsec_scatter - 2*a*dx*gamma*phi_R*timer*xsec_scatter - 2*a*dx*gamma*phi_halfNext_R*timer*xsec_scatter + a*dx*phi_L*timer**2*xsec_scatter - a*dx*phi_R*timer**2*xsec_scatter - a*dx*phi_halfNext_L*timer*timer2*xsec_scatter - a*dx*phi_halfNext_R*timer*timer2*xsec_scatter + 12*a*gamma**2*mu*psi_halfNext_rightBound + 8*a*gamma*mu*psi_halfNext_rightBound*timer + 8*a*gamma*mu*psi_rightBound*timer + 8*a*gamma*psi_halfLast_L*timer*timer2 - 8*a*gamma*psi_halfLast_R*timer*timer2 + 4*a*mu*psi_halfNext_rightBound*timer*timer2 + 4*a*mu*psi_rightBound*timer**2 + 4*a*psi_halfLast_L*timer**2*timer2 - 4*a*psi_halfLast_R*timer**2*timer2 + dx*gamma**3*phi_halfNext_R*xsec_scatter + dx*gamma**2*phi_R*timer*xsec_scatter + dx*gamma**2*phi_halfNext_R*timer*xsec_scatter + dx*gamma*phi_R*timer**2*xsec_scatter + dx*gamma*phi_halfNext_R*timer*timer2*xsec_scatter + dx*phi_R*timer**2*timer2*xsec_scatter - 4*gamma**3*mu*psi_halfNext_rightBound - 4*gamma**2*mu*psi_halfNext_rightBound*timer - 4*gamma**2*mu*psi_rightBound*timer + 4*gamma**2*psi_halfLast_R*timer*timer2 - 4*gamma*mu*psi_halfNext_rightBound*timer*timer2 - 4*gamma*mu*psi_rightBound*timer**2 + 4*gamma*psi_halfLast_R*timer**2*timer2 - 4*mu*psi_rightBound*timer**2*timer2 + 4*psi_halfLast_R*timer**2*timer2**2)/(16*a**4 - 32*a**3*gamma - 16*a**3*timer + 32*a**2*gamma**2 + 32*a**2*gamma*timer + 8*a**2*timer**2 - 16*a*gamma**3 - 24*a*gamma**2*timer - 8*a*gamma*timer**2 - 16*a*gamma*timer*timer2 - 8*a*timer**2*timer2 + 4*gamma**4 + 8*gamma**3*timer + 4*gamma**2*timer**2 + 8*gamma**2*timer*timer2 + 8*gamma*timer**2*timer2 + 4*timer**2*timer2**2)

    return(psi_n)